{
  "HDFS":{
    "service": [
      {
        "name": "datanode_process_percent",
        "label": "Percent DataNodes Available",
        "description": "The percentage of DataNodes that are responding to the process check compared to those that are not.",
        "interval": 1,
        "scope": "SERVICE",
        "enabled": true,
        "source": {
          "type": "AGGREGATE",
          "alert_name": "datanode_process",
          "reporting": {
            "ok": {
              "text": "affected: [{1}], total: [{0}]"
            },
            "warning": {
              "text": "affected: [{1}], total: [{0}]",
              "value": 0.1
            },
            "critical": {
              "text": "affected: [{1}], total: [{0}]",
              "value": 0.3
            }
          }
        }
      },
      {
        "name": "datanode_storage_percent",
        "label": "Percent DataNodes With Available Space",
        "description": "The percentage of DataNodes that report they have sufficient space compared to those that are not.",
        "interval": 1,
        "scope": "SERVICE",
        "enabled": true,
        "source": {
          "type": "AGGREGATE",
          "alert_name": "datanode_storage",
          "reporting": {
            "ok": {
              "text": "affected: [{1}], total: [{0}]"
            },
            "warning": {
              "text": "affected: [{1}], total: [{0}]",
              "value": 0.1
            },
            "critical": {
              "text": "affected: [{1}], total: [{0}]",
              "value": 0.3
            }
          }
        }
      },
      {
        "name": "journalnode_process_percent",
        "label": "Percent JournalNodes Available",
        "description": "The percentage of JournalNodes that are responding to the process check compared to those that are not.",
        "interval": 1,
        "scope": "SERVICE",
        "enabled": true,
        "source": {
          "type": "AGGREGATE",
          "alert_name": "journalnode_process",
          "reporting": {
            "ok": {
              "text": "affected: [{1}], total: [{0}]"
            },
            "warning": {
              "text": "affected: [{1}], total: [{0}]",
              "value": 0.33
            },
            "critical": {
              "text": "affected: [{1}], total: [{0}]",
              "value": 0.50
            }
          }
        }
      }
    ],
    "NAMENODE": [
      {
        "name": "namenode_webui",
        "label": "NameNode Web UI",
        "description": "An HTTP-style request to the NameNode webpage to verify that it can be accessed.",
        "interval": 1,
        "scope": "ANY",
        "enabled": true,
        "source": {
          "type": "WEB",
          "uri": {
            "http": "{{hdfs-site/dfs.namenode.http-address}}",
            "https": "{{hdfs-site/dfs.namenode.https-address}}",
            "https_property": "{{hdfs-site/dfs.http.policy}}",
            "https_property_value": "HTTPS_ONLY"
          },
          "reporting": {
            "ok": {
              "text": "HTTP {0} response in {2:.4f} seconds"
            },
            "warning":{
              "text": "HTTP {0} response in {2:.4f} seconds"
            },
            "critical": {
              "text": "Connection failed to {1}"
            }
          }
        }
      },
      {
        "name": "namenode_cpu",
        "label": "NameNode Host CPU Utilization",
        "description": "Checks that the CPU of the NameNode is below a certain load percentage.",
        "interval": 5,
        "scope": "ANY",
        "enabled": true,
        "source": {
          "type": "METRIC",
          "uri": {
            "http": "{{hdfs-site/dfs.namenode.http-address}}",
            "https": "{{hdfs-site/dfs.namenode.https-address}}",
            "https_property": "{{hdfs-site/dfs.http.policy}}",
            "https_property_value": "HTTPS_ONLY"
          },
          "reporting": {
            "ok": {
              "text": "{1} CPU, load {0:.1%}"
            },
            "warning": {
              "text": "{1} CPU, load {0:.1%}",
              "value": 200
            },
            "critical": {
              "text": "{1} CPU, load {0:.1%}",
              "value": 250
            }
          },
          "jmx": {
            "property_list": [
              "java.lang:type=OperatingSystem/SystemCpuLoad",
              "java.lang:type=OperatingSystem/AvailableProcessors"
            ],
            "value": "{0} * 100"
          }
        }
      },
      {
        "name": "namenode_hdfs_blocks_health",
        "label": "NameNode Blocks Health",
        "description": "Checks to see if the NameNode is reporting any blocks as missing.",
        "interval": 2,
        "scope": "ANY",
        "enabled": true,
        "source": {
          "type": "METRIC",
          "uri": {
            "http": "{{hdfs-site/dfs.namenode.http-address}}",
            "https": "{{hdfs-site/dfs.namenode.https-address}}",
            "https_property": "{{hdfs-site/dfs.http.policy}}",
            "https_property_value": "HTTPS_ONLY"
          },
          "reporting": {
            "ok": {
              "text": "Total Blocks:[{1}], Missing Blocks:[{0}]"
            },
            "warning": {
              "text": "Total Blocks:[{1}], Missing Blocks:[{0}]",
              "value": 1
            },          
            "critical": {
              "text": "Total Blocks:[{1}], Missing Blocks:[{0}]",
              "value": 1
            }
          },
          "jmx": {
            "property_list": [
              "Hadoop:service=NameNode,name=FSNamesystem/MissingBlocks",
              "Hadoop:service=NameNode,name=FSNamesystem/BlocksTotal"
            ],
            "value": "{0}"
          }
        }
      },
      {
        "name": "namenode_hdfs_capacity_utilization",
        "label": "HDFS Capacity Utilization",
        "description": "Checks the overall capacity remaining reported by the NameNode and triggers if it falls between a certain threshold",
        "interval": 2,
        "scope": "ANY",
        "enabled": true,
        "source": {
          "type": "METRIC",
          "uri": {
            "http": "{{hdfs-site/dfs.namenode.http-address}}",
            "https": "{{hdfs-site/dfs.namenode.https-address}}",
            "https_property": "{{hdfs-site/dfs.http.policy}}",
            "https_property_value": "HTTPS_ONLY"
          },
          "reporting": {
            "ok": {
              "text": "Capacity Used:[{2:d}%, {0}], Capacity Remaining:[{1}]"
            },
            "warning": {
              "text": "Capacity Used:[{2:d}%, {0}], Capacity Remaining:[{1}]",
              "value": 80
            },          
            "critical": {
              "text": "Capacity Used:[{2:d}%, {0}], Capacity Remaining:[{1}]",
              "value": 90
            }
          },
          "jmx": {
            "property_list": [
              "Hadoop:service=NameNode,name=FSNamesystemState/CapacityUsed",
              "Hadoop:service=NameNode,name=FSNamesystemState/CapacityRemaining"
            ],
            "value": "{0}/({0} + {1}) * 100"
          }
        }
      },
      {
        "name": "namenode_rpc_latency",
        "label": "NameNode RPC Latency",
        "description": "Check the TCP latency reported by the NameNode.",
        "interval": 2,
        "scope": "ANY",
        "enabled": true,
        "source": {
          "type": "METRIC",
          "uri": {
            "http": "{{hdfs-site/dfs.namenode.http-address}}",
            "https": "{{hdfs-site/dfs.namenode.https-address}}",
            "https_property": "{{hdfs-site/dfs.http.policy}}",
            "https_property_value": "HTTPS_ONLY"
          },
          "reporting": {
            "ok": {
              "text": "Average Queue Time:[{0}], Average Processing Time:[{1}]"
            },
            "warning": {
              "text": "Average Queue Time:[{0}], Average Processing Time:[{1}]",
              "value": 3000
            },          
            "critical": {
              "text": "Average Queue Time:[{0}], Average Processing Time:[{1}]",
              "value": 5000
            }
          },
          "jmx": {
            "property_list": [
              "Hadoop:service=NameNode,name=RpcActivityForPort*/RpcQueueTimeAvgTime",
              "Hadoop:service=NameNode,name=RpcActivityForPort*/RpcProcessingTimeAvgTime"
            ],
            "value": "{0}"
          }
        }
      },
      {
        "name": "namenode_directory_status",
        "label": "NameNode Directory Status",
        "description": "Checks the NameNode's NameDirStatuses metric to see if any directories report a failure.",
        "interval": 1,
        "scope": "ANY",
        "enabled": true,
        "source": {
          "type": "METRIC",
          "uri": {
            "http": "{{hdfs-site/dfs.namenode.http-address}}",
            "https": "{{hdfs-site/dfs.namenode.https-address}}",
            "https_property": "{{hdfs-site/dfs.http.policy}}",
            "https_property_value": "HTTPS_ONLY"
          },
          "reporting": {
            "ok": {
              "text": "Directories are healthy"
            },
            "warning": {
              "text": "Failed directory count: {1}",
              "value": 1
            },          
            "critical": {
              "text": "Failed directory count: {1}",
              "value": 1
            }
          },
          "jmx": {
            "property_list": [
              "Hadoop:service=NameNode,name=NameNodeInfo/NameDirStatuses"
            ],
            "value": "calculate(args)\ndef calculate(args):\n  import json\n  json_statuses = json.loads({0})\n  return len(json_statuses['failed']) if 'failed' in json_statuses else 0"
          }
        }
      },
      {
        "name": "namenode_process",
        "label": "NameNode Process",
        "description": "Checks that the NameNode process responds to a TCP port request.",
        "interval": 1,
        "scope": "ANY",
        "enabled": true,
        "source": {
          "type": "PORT",
          "uri": "{{hdfs-site/dfs.namenode.http-address}}",
          "default_port": 50070,
          "reporting": {
            "ok": {
              "text": "TCP OK - {0:.4f} response on port {1}"
            },
            "critical": {
              "text": "Connection failed: {0} to {1}:{2}"
            }
          }        
        }
      },
      {
        "name": "namenode_last_checkpoint",
        "label": "NameNode Last Checkpoint",
        "description": "Checks the last time that the NameNode performed a checkpoint. This script will also check for the number of uncommitted transactions.",
        "interval": 1,
        "scope": "ANY",
        "enabled": true,
        "source": {
          "type": "SCRIPT",
          "path": "HDP/2.0.6/services/HDFS/package/files/alert_checkpoint_time.py"
        }
      },
      {
        "name": "namenode_ha_health",
        "label": "NameNode High Availability Health",
        "description": "When running in HA mode, this will check the states of both the Active and Standby NameNode to ensure that there is exactly 1 of each.",
        "interval": 1,
        "scope": "ANY",
        "enabled": true,
        "ignore_host": true,
        "source": {
          "type": "SCRIPT",
          "path": "HDP/2.0.6/services/HDFS/package/files/alert_ha_namenode_health.py"
        }
      }
    ],
    "SECONDARY_NAMENODE": [
      {
        "name": "secondary_namenode_process",
        "label": "Secondary NameNode Process",
        "description": "Checks that the Secondary NameNode process responds to a TCP port request.",
        "interval": 1,
        "scope": "ANY",
        "enabled": true,
        "source": {
          "type": "PORT",
          "uri": "{{hdfs-site/dfs.namenode.secondary.http-address}}",
          "default_port": 50071,
          "reporting": {
            "ok": {
              "text": "TCP OK - {0:.4f} response on port {1}"
            },
            "critical": {
              "text": "Connection failed: {0} to {1}:{2}"
            }
          }        
        }
      }
    ],
    "JOURNALNODE": [
      {
        "name": "journalnode_process",
        "label": "JournalNode Process",
        "description": "Checks that the JournalNode process responds to a TCP port request.",
        "interval": 1,
        "scope": "HOST",
        "enabled": true,
        "source": {
          "type": "PORT",        
          "uri": "{{hdfs-site/dfs.journalnode.http-address}}",
          "default_port": 8480,
          "reporting": {
            "ok": {
              "text": "TCP OK - {0:.4f} response on port {1}"
            },
            "critical": {
              "text": "Connection failed: {0} to {1}:{2}"
            }
          }        
        }
      }
    ],      
    "DATANODE": [
      {
        "name": "datanode_process",
        "label": "DateNode Process",
        "description": "Checks that the DateNode process responds to a TCP port request.",
        "interval": 1,
        "scope": "HOST",
        "enabled": true,
        "source": {
          "type": "PORT",        
          "uri": "{{hdfs-site/dfs.datanode.address}}",
          "default_port": 50010,
          "reporting": {
            "ok": {
              "text": "TCP OK - {0:.4f} response on port {1}"
            },
            "critical": {
              "text": "Connection failed: {0} to {1}:{2}"
            }
          }        
        }
      },
      {
        "name": "datanode_webui",
        "label": "DataNode Web UI",
        "description": "An HTTP-style request to the DataNode webpage to verify that it can be accessed.",
        "interval": 1,
        "scope": "HOST",
        "enabled": true,
        "source": {
          "type": "WEB",
          "uri": {
            "http": "{{hdfs-site/dfs.datanode.http.address}}",
            "https": "{{hdfs-site/dfs.datanode.https.address}}",
            "https_property": "{{hdfs-site/dfs.http.policy}}",
            "https_property_value": "HTTPS_ONLY"
          },
          "reporting": {
            "ok": {
              "text": "HTTP {0} response in {2:.4f} seconds"
            },
            "warning":{
              "text": "HTTP {0} response in {2:.4f} seconds"
            },
            "critical": {
              "text": "Connection failed to {1}"
            }
          }
        }
      },    
      {
        "name": "datanode_storage",
        "label": "DataNode Storage",
        "description": "Checks the capacity remaining on a DataNode and triggers if below a certain percentage.",
        "interval": 2,
        "scope": "HOST",
        "enabled": true,
        "source": {
          "type": "METRIC",
          "uri": {
            "http": "{{hdfs-site/dfs.datanode.http.address}}",
            "https": "{{hdfs-site/dfs.datanode.https.address}}",
            "https_property": "{{hdfs-site/dfs.http.policy}}",
            "https_property_value": "HTTPS_ONLY"
          },
          "reporting": {
            "ok": {
              "text": "Remaining Capacity:[{0}], Total Capacity:[{2:d}% Used, {1}]"
            },
            "warning": {
              "text": "Remaining Capacity:[{0}], Total Capacity:[{2:d}% Used, {1}]",
              "value": 80
            },
            "critical": {
              "text": "Remaining Capacity:[{0}], Total Capacity:[{2:d}% Used, {1}]",
              "value": 90
            }
          },
          "jmx": {
            "property_list": [
              "Hadoop:service=DataNode,name=FSDatasetState-*/Remaining",
              "Hadoop:service=DataNode,name=FSDatasetState-*/Capacity"
            ],
            "value": "({1} - {0})/{1} * 100"
          }
        }
      }    
    ],
    "ZKFC": [
      {
        "name": "hdfs_zookeeper_failover_controller_process",
        "label": "ZooKeeper Failover Controller Process",
        "description": "Checks that the ZooKeeper Failover Controller process responds to a TCP port request.",
        "interval": 1,
        "scope": "ANY",
        "enabled": true,
        "source": {
          "type": "PORT",        
          "uri": "{{core-site/ha.zookeeper.quorum}}",
          "default_port": 2181,
          "reporting": {
            "ok": {
              "text": "TCP OK - {0:.4f} response on port {1}"
            },
            "critical": {
              "text": "Connection failed: {0} on host {1}:{2}"
            }
          }
        }
      }
    ]
  }
}
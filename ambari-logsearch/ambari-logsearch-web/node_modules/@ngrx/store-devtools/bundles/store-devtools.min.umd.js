!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?factory(exports,require("@angular/core"),require("@ngrx/store"),require("rxjs/ReplaySubject"),require("rxjs/operator/map"),require("rxjs/operator/merge"),require("rxjs/operator/observeOn"),require("rxjs/operator/scan"),require("rxjs/operator/skip"),require("rxjs/operator/withLatestFrom"),require("rxjs/scheduler/queue"),require("rxjs/Observable"),require("rxjs/observable/empty"),require("rxjs/operator/filter"),require("rxjs/operator/share"),require("rxjs/operator/switchMap"),require("rxjs/operator/takeUntil")):"function"==typeof define&&define.amd?define(["exports","@angular/core","@ngrx/store","rxjs/ReplaySubject","rxjs/operator/map","rxjs/operator/merge","rxjs/operator/observeOn","rxjs/operator/scan","rxjs/operator/skip","rxjs/operator/withLatestFrom","rxjs/scheduler/queue","rxjs/Observable","rxjs/observable/empty","rxjs/operator/filter","rxjs/operator/share","rxjs/operator/switchMap","rxjs/operator/takeUntil"],factory):factory((global.ngrx=global.ngrx||{},global.ngrx.storeDevtools=global.ngrx.storeDevtools||{}),global.ng.core,global.ngrx.store,global.Rx,global.Rx.Observable.prototype,global.Rx.Observable.prototype,global.Rx.Observable.prototype,global.Rx.Observable.prototype,global.Rx.Observable.prototype,global.Rx.Observable.prototype,global.Rx.Scheduler,global.Rx,global.Rx.Observable,global.Rx.Observable.prototype,global.Rx.Observable.prototype,global.Rx.Observable.prototype,global.Rx.Observable.prototype)}(this,function(exports,_angular_core,_ngrx_store,rxjs_ReplaySubject,rxjs_operator_map,rxjs_operator_merge,rxjs_operator_observeOn,rxjs_operator_scan,rxjs_operator_skip,rxjs_operator_withLatestFrom,rxjs_scheduler_queue,rxjs_Observable,rxjs_observable_empty,rxjs_operator_filter,rxjs_operator_share,rxjs_operator_switchMap,rxjs_operator_takeUntil){"use strict";function difference(first,second){return first.filter(function(item){return second.indexOf(item)<0})}function unliftState(liftedState){var computedStates=liftedState.computedStates,currentStateIndex=liftedState.currentStateIndex,state=computedStates[currentStateIndex].state;return state}function liftAction(action){return StoreDevtoolActions.performAction(action)}function applyOperators(input$,operators){return operators.reduce(function(source$,_a){var operator=_a[0],args=_a.slice(1);return operator.apply(source$,args)},input$)}function computeNextEntry(reducer,action,state,error){if(error)return{state:state,error:"Interrupted by an error up the chain"};var nextError,nextState=state;try{nextState=reducer(state,action)}catch(err){nextError=err.toString(),console.error(err.stack||err)}return{state:nextState,error:nextError}}function recomputeStates(computedStates,minInvalidatedStateIndex,reducer,committedState,actionsById,stagedActionIds,skippedActionIds){if(minInvalidatedStateIndex>=computedStates.length&&computedStates.length===stagedActionIds.length)return computedStates;for(var nextComputedStates=computedStates.slice(0,minInvalidatedStateIndex),i=minInvalidatedStateIndex;i<stagedActionIds.length;i++){var actionId=stagedActionIds[i],action=actionsById[actionId].action,previousEntry=nextComputedStates[i-1],previousState=previousEntry?previousEntry.state:committedState,previousError=previousEntry?previousEntry.error:void 0,shouldSkip=skippedActionIds.indexOf(actionId)>-1,entry=shouldSkip?previousEntry:computeNextEntry(reducer,action,previousState,previousError);nextComputedStates.push(entry)}return nextComputedStates}function liftInitialState(initialCommittedState,monitorReducer){return{monitorState:monitorReducer(void 0,{}),nextActionId:1,actionsById:{0:liftAction(INIT_ACTION)},stagedActionIds:[0],skippedActionIds:[],committedState:initialCommittedState,currentStateIndex:0,computedStates:[]}}function liftReducerWith(initialCommittedState,initialLiftedState,monitorReducer,options){return void 0===options&&(options={}),function(reducer){return function(liftedState,liftedAction){function commitExcessActions(n){for(var excess=n,idsToDelete=stagedActionIds.slice(1,excess+1),i=0;i<idsToDelete.length;i++){if(computedStates[i+1].error){excess=i,idsToDelete=stagedActionIds.slice(1,excess+1);break}delete actionsById[idsToDelete[i]]}skippedActionIds=skippedActionIds.filter(function(id){return-1===idsToDelete.indexOf(id)}),stagedActionIds=[0].concat(stagedActionIds.slice(excess+1)),committedState=computedStates[excess].state,computedStates=computedStates.slice(excess),currentStateIndex=currentStateIndex>excess?currentStateIndex-excess:0}var _a=liftedState||initialLiftedState,monitorState=_a.monitorState,actionsById=_a.actionsById,nextActionId=_a.nextActionId,stagedActionIds=_a.stagedActionIds,skippedActionIds=_a.skippedActionIds,committedState=_a.committedState,currentStateIndex=_a.currentStateIndex,computedStates=_a.computedStates;liftedState||(actionsById=Object.create(actionsById));var minInvalidatedStateIndex=0;switch(liftedAction.type){case ActionTypes.RESET:actionsById={0:liftAction(INIT_ACTION)},nextActionId=1,stagedActionIds=[0],skippedActionIds=[],committedState=initialCommittedState,currentStateIndex=0,computedStates=[];break;case ActionTypes.COMMIT:actionsById={0:liftAction(INIT_ACTION)},nextActionId=1,stagedActionIds=[0],skippedActionIds=[],committedState=computedStates[currentStateIndex].state,currentStateIndex=0,computedStates=[];break;case ActionTypes.ROLLBACK:actionsById={0:liftAction(INIT_ACTION)},nextActionId=1,stagedActionIds=[0],skippedActionIds=[],currentStateIndex=0,computedStates=[];break;case ActionTypes.TOGGLE_ACTION:var actionId_1=liftedAction.id,index=skippedActionIds.indexOf(actionId_1);skippedActionIds=-1===index?[actionId_1].concat(skippedActionIds):skippedActionIds.filter(function(id){return id!==actionId_1}),minInvalidatedStateIndex=stagedActionIds.indexOf(actionId_1);break;case ActionTypes.SET_ACTIONS_ACTIVE:for(var start=liftedAction.start,end=liftedAction.end,active=liftedAction.active,actionIds=[],i=start;end>i;i++)actionIds.push(i);skippedActionIds=active?difference(skippedActionIds,actionIds):skippedActionIds.concat(actionIds),minInvalidatedStateIndex=stagedActionIds.indexOf(start);break;case ActionTypes.JUMP_TO_STATE:currentStateIndex=liftedAction.index,minInvalidatedStateIndex=1/0;break;case ActionTypes.SWEEP:stagedActionIds=difference(stagedActionIds,skippedActionIds),skippedActionIds=[],currentStateIndex=Math.min(currentStateIndex,stagedActionIds.length-1);break;case ActionTypes.PERFORM_ACTION:options.maxAge&&stagedActionIds.length===options.maxAge&&commitExcessActions(1),currentStateIndex===stagedActionIds.length-1&&currentStateIndex++;var actionId=nextActionId++;actionsById[actionId]=liftedAction,stagedActionIds=stagedActionIds.concat([actionId]),minInvalidatedStateIndex=stagedActionIds.length-1;break;case ActionTypes.IMPORT_STATE:_b=liftedAction.nextLiftedState,monitorState=_b.monitorState,actionsById=_b.actionsById,nextActionId=_b.nextActionId,stagedActionIds=_b.stagedActionIds,skippedActionIds=_b.skippedActionIds,committedState=_b.committedState,currentStateIndex=_b.currentStateIndex,computedStates=_b.computedStates;break;case _ngrx_store.Reducer.REPLACE:case _ngrx_store.Dispatcher.INIT:minInvalidatedStateIndex=0,options.maxAge&&stagedActionIds.length>options.maxAge&&(computedStates=recomputeStates(computedStates,minInvalidatedStateIndex,reducer,committedState,actionsById,stagedActionIds,skippedActionIds),commitExcessActions(stagedActionIds.length-options.maxAge),minInvalidatedStateIndex=1/0);break;default:minInvalidatedStateIndex=1/0}return computedStates=recomputeStates(computedStates,minInvalidatedStateIndex,reducer,committedState,actionsById,stagedActionIds,skippedActionIds),monitorState=monitorReducer(monitorState,liftedAction),{monitorState:monitorState,actionsById:actionsById,nextActionId:nextActionId,stagedActionIds:stagedActionIds,skippedActionIds:skippedActionIds,committedState:committedState,currentStateIndex:currentStateIndex,computedStates:computedStates};var _b}}}function _createReduxDevtoolsExtension(){var legacyExtensionKey="devToolsExtension",extensionKey="__REDUX_DEVTOOLS_EXTENSION__";return"object"==typeof window&&"undefined"!=typeof window[legacyExtensionKey]?window[legacyExtensionKey]:"object"==typeof window&&"undefined"!=typeof window[extensionKey]?window[extensionKey]:null}function _createState(devtools){return devtools.state}function _createReducer(dispatcher,reducer){return new _ngrx_store.Reducer(dispatcher,reducer)}function _createStateIfExtension(extension,injector,initialState){if(extension){var devtools=injector.get(StoreDevtools);return _createState(devtools)}var dispatcher=injector.get(_ngrx_store.Dispatcher),reducer=injector.get(_ngrx_store.Reducer);return new _ngrx_store.State(initialState,dispatcher,reducer)}function _createReducerIfExtension(extension,injector,reducer){if(extension){var devtoolsDispatcher=injector.get(DevtoolsDispatcher);return _createReducer(devtoolsDispatcher,reducer)}var dispatcher=injector.get(_ngrx_store.Dispatcher);return new _ngrx_store.Reducer(dispatcher,reducer)}function noMonitor(){return null}function _createOptions(_options){var DEFAULT_OPTIONS={monitor:noMonitor},options="function"==typeof _options?_options():_options;if(options=Object.assign({},DEFAULT_OPTIONS,options),options.maxAge&&options.maxAge<2)throw new Error("Devtools 'maxAge' cannot be less than 2, got "+options.maxAge);return options}var ActionTypes={PERFORM_ACTION:"PERFORM_ACTION",RESET:"RESET",ROLLBACK:"ROLLBACK",COMMIT:"COMMIT",SWEEP:"SWEEP",TOGGLE_ACTION:"TOGGLE_ACTION",SET_ACTIONS_ACTIVE:"SET_ACTIONS_ACTIVE",JUMP_TO_STATE:"JUMP_TO_STATE",IMPORT_STATE:"IMPORT_STATE"},StoreDevtoolActions={performAction:function(action){if("undefined"==typeof action.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');return{type:ActionTypes.PERFORM_ACTION,action:action,timestamp:Date.now()}},reset:function(){return{type:ActionTypes.RESET,timestamp:Date.now()}},rollback:function(){return{type:ActionTypes.ROLLBACK,timestamp:Date.now()}},commit:function(){return{type:ActionTypes.COMMIT,timestamp:Date.now()}},sweep:function(){return{type:ActionTypes.SWEEP}},toggleAction:function(id){return{type:ActionTypes.TOGGLE_ACTION,id:id}},setActionsActive:function(start,end,active){return void 0===active&&(active=!0),{type:ActionTypes.SET_ACTIONS_ACTIVE,start:start,end:end,active:active}},jumpToState:function(index){return{type:ActionTypes.JUMP_TO_STATE,index:index}},importState:function(nextLiftedState){return{type:ActionTypes.IMPORT_STATE,nextLiftedState:nextLiftedState}}},ExtensionActionTypes={START:"START",DISPATCH:"DISPATCH",STOP:"STOP",ACTION:"ACTION"},REDUX_DEVTOOLS_EXTENSION=new _angular_core.OpaqueToken("Redux Devtools Extension"),DevtoolsExtension=function(){function DevtoolsExtension(devtoolsExtension){this.instanceId="ngrx-store-"+Date.now(),this.devtoolsExtension=devtoolsExtension,this.createActionStreams()}return DevtoolsExtension.prototype.notify=function(action,state){this.devtoolsExtension&&this.devtoolsExtension.send(null,state,!1,this.instanceId)},DevtoolsExtension.prototype.createChangesObservable=function(){var _this=this;return this.devtoolsExtension?new rxjs_Observable.Observable(function(subscriber){var connection=_this.devtoolsExtension.connect({instanceId:_this.instanceId});return connection.subscribe(function(change){return subscriber.next(change)}),connection.unsubscribe}):rxjs_observable_empty.empty()},DevtoolsExtension.prototype.createActionStreams=function(){var _this=this,changes$=rxjs_operator_share.share.call(this.createChangesObservable()),start$=rxjs_operator_filter.filter.call(changes$,function(change){return change.type===ExtensionActionTypes.START}),stop$=rxjs_operator_filter.filter.call(changes$,function(change){return change.type===ExtensionActionTypes.STOP}),liftedActions$=applyOperators(changes$,[[rxjs_operator_filter.filter,function(change){return change.type===ExtensionActionTypes.DISPATCH}],[rxjs_operator_map.map,function(change){return _this.unwrapAction(change.payload)}]]),actions$=applyOperators(changes$,[[rxjs_operator_filter.filter,function(change){return change.type===ExtensionActionTypes.ACTION}],[rxjs_operator_map.map,function(change){return _this.unwrapAction(change.payload)}]]),actionsUntilStop$=rxjs_operator_takeUntil.takeUntil.call(actions$,stop$),liftedUntilStop$=rxjs_operator_takeUntil.takeUntil.call(liftedActions$,stop$);this.actions$=rxjs_operator_switchMap.switchMap.call(start$,function(){return actionsUntilStop$}),this.liftedActions$=rxjs_operator_switchMap.switchMap.call(start$,function(){return liftedUntilStop$})},DevtoolsExtension.prototype.unwrapAction=function(action){return"string"==typeof action?eval("("+action+")"):action},DevtoolsExtension}();DevtoolsExtension.decorators=[{type:_angular_core.Injectable}],DevtoolsExtension.ctorParameters=function(){return[{type:void 0,decorators:[{type:_angular_core.Inject,args:[REDUX_DEVTOOLS_EXTENSION]}]}]};var INIT_ACTION={type:_ngrx_store.Dispatcher.INIT},STORE_DEVTOOLS_CONFIG=new _angular_core.OpaqueToken("@ngrx/devtools Options"),INITIAL_OPTIONS=new _angular_core.OpaqueToken("@ngrx/devtools Initial Config"),__extends=void 0||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),DevtoolsDispatcher=function(_super){function DevtoolsDispatcher(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(DevtoolsDispatcher,_super),DevtoolsDispatcher}(_ngrx_store.Dispatcher);DevtoolsDispatcher.decorators=[{type:_angular_core.Injectable}],DevtoolsDispatcher.ctorParameters=function(){return[]};var StoreDevtools=function(){function StoreDevtools(dispatcher,actions$,reducers$,extension,initialState,config){var liftedInitialState=liftInitialState(initialState,config.monitor),liftReducer=liftReducerWith(initialState,liftedInitialState,config.monitor,{maxAge:config.maxAge}),liftedAction$=applyOperators(actions$,[[rxjs_operator_skip.skip,1],[rxjs_operator_merge.merge,extension.actions$],[rxjs_operator_map.map,liftAction],[rxjs_operator_merge.merge,dispatcher,extension.liftedActions$],[rxjs_operator_observeOn.observeOn,rxjs_scheduler_queue.queue]]),liftedReducer$=rxjs_operator_map.map.call(reducers$,liftReducer),liftedStateSubject=new rxjs_ReplaySubject.ReplaySubject(1),liftedStateSubscription=applyOperators(liftedAction$,[[rxjs_operator_withLatestFrom.withLatestFrom,liftedReducer$],[rxjs_operator_scan.scan,function(liftedState,_a){var action=_a[0],reducer=_a[1],nextState=reducer(liftedState,action);return extension.notify(action,nextState),nextState},liftedInitialState]]).subscribe(liftedStateSubject),liftedState$=liftedStateSubject.asObservable(),state$=rxjs_operator_map.map.call(liftedState$,unliftState);this.stateSubscription=liftedStateSubscription,this.dispatcher=dispatcher,this.liftedState=liftedState$,this.state=state$}return StoreDevtools.prototype.dispatch=function(action){this.dispatcher.dispatch(action)},StoreDevtools.prototype.next=function(action){this.dispatcher.dispatch(action)},StoreDevtools.prototype.error=function(){},StoreDevtools.prototype.complete=function(){},StoreDevtools.prototype.performAction=function(action){this.dispatch(StoreDevtoolActions.performAction(action))},StoreDevtools.prototype.reset=function(){this.dispatch(StoreDevtoolActions.reset())},StoreDevtools.prototype.rollback=function(){this.dispatch(StoreDevtoolActions.rollback())},StoreDevtools.prototype.commit=function(){this.dispatch(StoreDevtoolActions.commit())},StoreDevtools.prototype.sweep=function(){this.dispatch(StoreDevtoolActions.sweep())},StoreDevtools.prototype.toggleAction=function(id){this.dispatch(StoreDevtoolActions.toggleAction(id))},StoreDevtools.prototype.jumpToState=function(index){this.dispatch(StoreDevtoolActions.jumpToState(index))},StoreDevtools.prototype.importState=function(nextLiftedState){this.dispatch(StoreDevtoolActions.importState(nextLiftedState))},StoreDevtools}();StoreDevtools.decorators=[{type:_angular_core.Injectable}],StoreDevtools.ctorParameters=function(){return[{type:DevtoolsDispatcher},{type:_ngrx_store.Dispatcher},{type:_ngrx_store.Reducer},{type:DevtoolsExtension},{type:void 0,decorators:[{type:_angular_core.Inject,args:[_ngrx_store.INITIAL_STATE]}]},{type:void 0,decorators:[{type:_angular_core.Inject,args:[STORE_DEVTOOLS_CONFIG]}]}]};var StoreDevtoolsModule=function(){function StoreDevtoolsModule(){}return StoreDevtoolsModule.instrumentStore=function(_options){return void 0===_options&&(_options={}),{ngModule:StoreDevtoolsModule,providers:[{provide:_ngrx_store.State,deps:[StoreDevtools],useFactory:_createState},{provide:INITIAL_OPTIONS,useValue:_options},{provide:_ngrx_store.Reducer,deps:[DevtoolsDispatcher,_ngrx_store.INITIAL_REDUCER],useFactory:_createReducer},{provide:STORE_DEVTOOLS_CONFIG,deps:[INITIAL_OPTIONS],useFactory:_createOptions}]}},StoreDevtoolsModule.instrumentOnlyWithExtension=function(_options){return void 0===_options&&(_options={}),{ngModule:StoreDevtoolsModule,providers:[{provide:_ngrx_store.State,deps:[REDUX_DEVTOOLS_EXTENSION,_angular_core.Injector,_ngrx_store.INITIAL_STATE],useFactory:_createStateIfExtension},{provide:_ngrx_store.Reducer,deps:[REDUX_DEVTOOLS_EXTENSION,_angular_core.Injector,_ngrx_store.INITIAL_REDUCER],useFactory:_createReducerIfExtension},{provide:INITIAL_OPTIONS,useValue:_options},{provide:STORE_DEVTOOLS_CONFIG,deps:[INITIAL_OPTIONS],useFactory:_createOptions}]}},StoreDevtoolsModule}();StoreDevtoolsModule.decorators=[{type:_angular_core.NgModule,args:[{imports:[_ngrx_store.StoreModule],providers:[DevtoolsExtension,DevtoolsDispatcher,StoreDevtools,{provide:REDUX_DEVTOOLS_EXTENSION,useFactory:_createReduxDevtoolsExtension}]}]}],StoreDevtoolsModule.ctorParameters=function(){return[]},exports.StoreDevtoolsModule=StoreDevtoolsModule,exports.StoreDevtools=StoreDevtools,Object.defineProperty(exports,"__esModule",{value:!0})});